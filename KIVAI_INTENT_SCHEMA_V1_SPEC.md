# KIVAI Intent Schema v1.0 Specification

**Platform:** Kivai  
**Version:** v1.0 (Spec)  
**Topology Assumption:** Gateway/Hub orchestrated (default)  
**Scope:** Universal, transport-agnostic  

---

## 1. Purpose

This document defines the canonical Kivai intent payload format for v1.0.

Kivai intents are structured, auditable execution contracts generated by an AI system (or gateway) and consumed by devices or device adapters.

---

## 2. Design Goals

- Deterministic execution across device ecosystems  
- Transport-agnostic payload (Wi-Fi, BLE, MQTT, etc.)  
- Strong targeting model (device_id or capability+zone)  
- Standard lifecycle responses (acknowledged | success | failed)  
- Security baseline for sensitive intents  
- Traceability via intent_id  

---

## 3. Canonical v1.0 Payload (Normative)

A Kivai v1.0 intent payload MUST be a JSON object with these top-level fields.

### 3.1 Required Fields

- `intent_id` (string)  
  Unique identifier for the intent, used for tracking and response correlation.

- `intent` (string)  
  Canonical action identifier (e.g., `close`, `lock`, `set_temperature`, `locate`).

- `target` (object)  
  Defines routing and selection of the execution endpoint.

- `meta` (object)  
  Metadata for observability and auditing.

### 3.2 Optional Fields

- `params` (object)  
  Intent-specific parameters (e.g., `{ "value": 21, "unit": "C" }`).

- `auth` (object)  
  Authorization proof and required role. REQUIRED for sensitive intents (see Section 6).

---

## 4. Target Model (Normative)

The `target` object MUST support both strategies.

### 4.1 Direct Targeting (Preferred)

```json
{
  "target": {
    "device_id": "door-patio-01"
  }
}
```

### 4.2 Capability + Zone Targeting (Fallback)

```json
{
  "target": {
    "capability": "lock_control",
    "zone": "patio"
  }
}
```

At least one of `device_id` OR (`capability` + `zone`) MUST be present.

---

## 5. Meta Model (Normative)

The `meta` object MUST include:

- `timestamp` (string, ISO 8601 date-time)
- `language` (string, e.g., `en`, `es`)
- `confidence` (number 0..1)

It MAY include:

- `source` (string, e.g., `gateway`, `assistant`)
- `trigger` (string, e.g., `Kivai`)
- `user_id` (string, optional)

Example:

```json
{
  "meta": {
    "timestamp": "2026-02-06T21:10:00Z",
    "language": "en",
    "confidence": 0.98,
    "source": "gateway",
    "trigger": "Kivai"
  }
}
```

---

## 6. Security Baseline (Normative)

### 6.1 Sensitive Intents

The following categories are considered sensitive by default:

- locks / doors / alarms  
- payments / purchases  
- safety-critical actuators  
- surveillance and tracking  

For sensitive intents, `auth` MUST be present.

### 6.2 Auth Object (Minimal v1.0)

```json
{
  "auth": {
    "required_role": "owner",
    "token": "signed-session-token"
  }
}
```

Devices MUST reject sensitive intents if:

- `auth` is missing  
- token is invalid or expired  
- role is insufficient  

---

## 7. Response Lifecycle (Normative)

Devices (or adapters) MUST respond with:

- `intent_id` (string)
- `status` (string): `acknowledged` | `success` | `failed`
- `device_id` (string)
- `timestamp` (string)

On failure, include:

- `error` (object):
  - `code` (string)
  - `message` (string)

---

## 8. Examples

### 8.1 Close Patio Door (Sensitive)

```json
{
  "intent_id": "c9c4c8d1-2d6f-4d6c-9a2f-1f2c3a4b5c6d",
  "intent": "close",
  "target": { "device_id": "door-patio-01" },
  "params": { "mode": "close_then_lock" },
  "auth": { "required_role": "owner", "token": "signed-session-token" },
  "meta": {
    "timestamp": "2026-02-06T21:10:00Z",
    "language": "es",
    "confidence": 0.97,
    "source": "gateway",
    "trigger": "Kivai"
  }
}
```

### 8.2 Locate Glasses (Non-sensitive)

```json
{
  "intent_id": "1b2b3b4b-5c6d-7e8f-9a0b-1c2d3e4f5a6b",
  "intent": "locate",
  "target": { "device_id": "glasses-01" },
  "params": { "mode": "beep", "duration_s": 10 },
  "meta": {
    "timestamp": "2026-02-06T21:15:00Z",
    "language": "en",
    "confidence": 0.99,
    "source": "gateway"
  }
}
```

---

## 9. Backward Compatibility Note (Non-normative)

Earlier Kivai drafts used `command`, `object`, and `trigger`.

v1.0 standardizes on `intent`, `target`, and `meta` to support universal interoperability, routing, and security.

---

**End of Specification**

